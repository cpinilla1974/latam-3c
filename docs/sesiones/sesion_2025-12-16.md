# Sesión 2025-12-16: Corrección Fórmulas y Filtro de Años

## Objetivo
Corregir fórmula de cemento equivalente y filtrar agregación nacional a años con datos completos.

## Trabajo Realizado

### 1. Corrección Fórmula Cemento Equivalente

**Problema**: La fórmula `[21b] = [20] + [10] × 1.6` era incorrecta (inventada sin fuente oficial).

**Solución**: Se encontró la fórmula correcta en la hoja 'Comments' del protocolo GNR (row 67):
```
[21b] = [8] / [92a] = Clínker producido / Factor clínker
```

**Archivos actualizados**:
- `FORMULAS_AGREGACION.md` (v1.3)
- `PROCESO_AGREGACION_NACIONAL.md` (v1.1)
- `calcular_agregados_nacionales.py`

### 2. Análisis de Anomalías en Datos 2015

Se detectaron saltos inexplicables en los gráficos, especialmente:
- Consumo térmico [93]: 8,534 MJ/t en 2015 vs ~3,400 normal
- Producción [8]: caída del 86% de 2014 a 2015

**Causa identificada**: Datos incompletos por año. Análisis de cobertura:

| Año | Plantas | Estado |
|-----|---------|--------|
| 2010 | 5 | ✓ Completo (Piura no existía) |
| 2014 | 5 | ✓ Completo (Piura no existía) |
| 2015 | 2 | ✗ Faltan: UNACEM, Yura, Piura |
| 2016 | 4 | ✗ Faltan: UNACEM |
| 2017 | 3 | ✗ Faltan: UNACEM, Yura |
| 2018 | 5 | ✗ Falta: Yura |
| 2019 | 6 | ✓ Completo |
| 2020 | 6 | ✓ Completo |
| 2021 | 6 | ✓ Completo |
| 2022 | 4 | ✗ Faltan: UNACEM |
| 2023 | 3 | ✗ Faltan: UNACEM, Yura |
| 2024 | 6 | ✓ Completo |

### 3. Filtro de Años Válidos

Se modificó el script para calcular agregados solo con años de cobertura completa:

```python
AÑOS_VALIDOS = [2010, 2014, 2019, 2020, 2021, 2024]
```

**Resultado**:
- Antes: 687 registros (12 años con datos distorsionados)
- Después: 398 registros (6 años con datos representativos)

### 4. Validación de Indicadores

Valores consistentes tras el filtro:
- Consumo térmico [93]: 3,340-3,546 MJ/t
- Factor clínker [92a]: 0.74-0.82
- Emisión bruta clínker [60]: 775-798 kgCO₂/t
- Emisión neta cementitious [74]: 563-645 kgCO₂/t

## Archivos Modificados

- `data_peru/scripts/calcular_agregados_nacionales.py` - Añadido AÑOS_VALIDOS
- `data_peru/docs/FORMULAS_AGREGACION.md` - Corregida fórmula [21b] (v1.3)
- `data_peru/docs/PROCESO_AGREGACION_NACIONAL.md` - Añadida sección años válidos (v1.2)
- `data_peru/datos_procesados/agregados_nacionales.csv` - Regenerado con 6 años

## Plantas en Base de Datos

| ID | Planta | Empresa |
|----|--------|---------|
| 15 | Rioja | Pacasmayo |
| 16 | Pacasmayo | Pacasmayo |
| 17 | Piura | Pacasmayo |
| 21 | Condorcocha | UNACEM |
| 22 | Atocongo | UNACEM |
| 23 | Yura | Yura |

## Próximos Pasos

- Obtener datos faltantes para años 2015-2018 y 2022-2023
- Validar indicadores de cemento y cemento equivalente contra Excel
- Completar campo [41] para plantas faltantes