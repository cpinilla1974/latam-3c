# SesiÃ³n de Trabajo - 2025-12-06

## Fecha
2025-12-06

## Objetivo de la sesiÃ³n
Replanificar arquitectura del proyecto de dos aplicaciones monolÃ­ticas a arquitectura separada por responsabilidades

## Estado inicial
- Proyecto v1 implementado como monolito Streamlit Ãºnico
- ConfusiÃ³n sobre app de formularios web (fue movida a Etapa 2 en sept 2024)
- MenÃº de navegaciÃ³n desorganizado con pÃ¡ginas dummy
- Limpieza exitosa: eliminadas 15 pÃ¡ginas dummy (11 archivos + 4 duplicados)
- Arquitectura actual: 27 pÃ¡ginas funcionales en 8 secciones

## Decisiones EstratÃ©gicas

### 1. NUEVA ARQUITECTURA: Tres Aplicaciones Separadas

**App 1: FICEM Core (Backend + Procesamiento)**
- **Responsabilidad**: Motor de cÃ¡lculos, validaciÃ³n, algoritmos
- **Usuarios**: Operador FICEM
- **TecnologÃ­a**: Streamlit (inicialmente) â†’ APIs REST (futuro)
- **Funcionalidad**:
  - ImportaciÃ³n de archivos Excel
  - ValidaciÃ³n multinivel de datos
  - Motor de cÃ¡lculos A1-A3 (Clinker, Cemento, Concreto)
  - ClasificaciÃ³n GCCA
  - Base de datos centralizada (SQLite)
  - GestiÃ³n de factores de emisiÃ³n

**App 2: 4C PerÃº (Frontend + Reporte PaÃ­s)**
- **Responsabilidad**: Resultados especÃ­ficos PerÃº, informaciÃ³n contextual
- **Usuarios**: Stakeholders, empresas, pÃºblico
- **TecnologÃ­a**: Streamlit o Next.js (para mejor UX)
- **Funcionalidad**:
  - Dashboard con resultados de PerÃº
  - VisualizaciÃ³n bandas GCCA para empresas peruanas
  - Benchmarking nacional
  - InformaciÃ³n de empresas participantes
  - Generador de Excel como frontend (consume microservicio)
  - Reportes especÃ­ficos PerÃº

**Microservicio: Generador Excel**
- **Responsabilidad**: Generar plantillas Excel personalizadas
- **Acceso**: Consumido por 4C PerÃº como API REST
- **UbicaciÃ³n**: Puede residir en FICEM Core o ser independiente
- **Funcionalidad**:
  - Generador dinÃ¡mico de templates
  - Perfil de planta (integrada/molienda/concreto)
  - Hojas y validaciones personalizadas
  - Retorna archivo descargable

### 2. FLUJO DE TRABAJO ESCALABLE

```
FLUJO GENERAL (Para todos los paÃ­ses)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          FICEM CORE (Backend Centralizado)           â”‚
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Microservicios/APIs:                            â”‚ â”‚
â”‚  â”‚  â€¢ Generador Excel (REST)                       â”‚ â”‚
â”‚  â”‚  â€¢ Validador (REST)                             â”‚ â”‚
â”‚  â”‚  â€¢ Calculador A1-A3 (REST)                      â”‚ â”‚
â”‚  â”‚  â€¢ Clasificador GCCA (REST)                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                       â†“                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Base de Datos Centralizada:                     â”‚ â”‚
â”‚  â”‚  â€¢ Empresas, plantas, datos, resultados         â”‚ â”‚
â”‚  â”‚  â€¢ Benchmarking anÃ³nimo global                  â”‚ â”‚
â”‚  â”‚  â€¢ Factores de emisiÃ³n                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                       â†“                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ GestiÃ³n Operador FICEM:                         â”‚ â”‚
â”‚  â”‚  â€¢ Carga de archivos                            â”‚ â”‚
â”‚  â”‚  â€¢ ValidaciÃ³n de datos                          â”‚ â”‚
â”‚  â”‚  â€¢ Procesamiento de cÃ¡lculos                    â”‚ â”‚
â”‚  â”‚  â€¢ Monitoreo de estado                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“                          â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   4C PERÃš (Frontend) â”‚  â”‚ 4C COLOMBIA, etc     â”‚
    â”‚                      â”‚  â”‚ (Futuros frontends)  â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚                      â”‚
    â”‚  â”‚ Dashboard PerÃº â”‚  â”‚  â”‚ Mismo patrÃ³n para    â”‚
    â”‚  â”‚ Empresas Peruv.â”‚  â”‚  â”‚ cada paÃ­s            â”‚
    â”‚  â”‚ Benchmarks     â”‚  â”‚  â”‚                      â”‚
    â”‚  â”‚ Gen. Excel API â”‚  â”‚  â”‚                      â”‚
    â”‚  â”‚ Reportes PerÃº  â”‚  â”‚  â”‚                      â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚                      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. ESTRUCTURA DE CARPETAS PROPUESTA

```
latam-3c/
â”œâ”€â”€ ficem-core/                    # App backend centralizada
â”‚   â”œâ”€â”€ app.py                     # Streamlit app operador
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â”œâ”€â”€ modules/
â”‚   â”‚   â”œâ”€â”€ calculator.py          # Motor A1-A3
â”‚   â”‚   â”œâ”€â”€ validator.py           # Validaciones
â”‚   â”‚   â”œâ”€â”€ excel_generator.py     # Generador templates
â”‚   â”‚   â”œâ”€â”€ excel_parser.py        # Parser datos
â”‚   â”‚   â””â”€â”€ classifier.py          # GCCA classification
â”‚   â”œâ”€â”€ api/                       # APIs REST (futuro)
â”‚   â”‚   â”œâ”€â”€ generator_api.py       # Generador como API
â”‚   â”‚   â”œâ”€â”€ validator_api.py
â”‚   â”‚   â””â”€â”€ calculator_api.py
â”‚   â”œâ”€â”€ database/
â”‚   â”‚   â”œâ”€â”€ models.py
â”‚   â”‚   â””â”€â”€ latam4c.db
â”‚   â””â”€â”€ config/
â”‚       â”œâ”€â”€ factores_emision.py
â”‚       â””â”€â”€ bandas_gcca.py
â”‚
â”œâ”€â”€ 4c-peru/                       # App frontend especÃ­fica de PerÃº
â”‚   â”œâ”€â”€ app.py                     # Streamlit app (o frontend Next.js)
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ 01_dashboard.py
â”‚   â”‚   â”œâ”€â”€ 02_empresas.py
â”‚   â”‚   â”œâ”€â”€ 03_generador_excel.py  # Consume API del generador
â”‚   â”‚   â”œâ”€â”€ 04_benchmarks.py
â”‚   â”‚   â””â”€â”€ 05_resultados.py
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ api_config.py          # URLs de APIs FICEM
â”‚   â””â”€â”€ utils/
â”‚       â””â”€â”€ api_client.py          # Cliente REST
â”‚
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ sesiones/
â”‚   â”‚   â””â”€â”€ sesion_2025-12-06.md   # Este documento
â”‚   â””â”€â”€ arquitectura/
â”‚       â””â”€â”€ arquitectura_actualizada.md
â”‚
â””â”€â”€ [archivos de configuraciÃ³n raÃ­z]
```

### 4. BENEFICIOS DE ESTA ARQUITECTURA

âœ… **SeparaciÃ³n de responsabilidades**
- LÃ³gica compleja (cÃ¡lculos) â†’ FICEM Core
- PresentaciÃ³n especÃ­fica paÃ­s â†’ 4C PerÃº/Colombia/etc

âœ… **ReutilizaciÃ³n**
- Mismos algoritmos para todos los paÃ­ses
- Mismo motor de validaciÃ³n
- Mismo generador Excel (como API)

âœ… **Escalabilidad**
- Agregar nuevo paÃ­s = nuevo frontend
- Sin duplicar lÃ³gica de cÃ¡lculo
- Base de datos centralizada para benchmarking

âœ… **Mantenimiento**
- Cambios en fÃ³rmulas â†’ solo FICEM Core
- Bug en cÃ¡lculo â†’ se arregla una vez para todos
- Nuevas validaciones â†’ implementadas centralmente

âœ… **Seguridad**
- FICEM Core puede estar en red privada
- Solo Frontends expuestos pÃºblicamente
- APIs con autenticaciÃ³n entre aplicaciones

âœ… **Flexibilidad tecnolÃ³gica**
- 4C PerÃº puede ser Streamlit, Next.js, React, etc.
- FICEM Core comienza como Streamlit, evoluciona a APIs REST
- Microservicio generador independiente

### 5. PLAN DE IMPLEMENTACIÃ“N

**Fase Actual (Diciembre 2025):**
1. Separar cÃ³digo v1 en dos aplicaciones
2. Mover lÃ³gica de cÃ¡lculos a `ficem-core`
3. Crear `4c-peru` con vistas especÃ­ficas
4. Documentar divisiÃ³n responsabilidades

**Fase 2 (Enero-Febrero 2026):**
1. Implementar APIs REST en FICEM Core
2. Crear cliente REST en 4C PerÃº
3. Convertir generador a microservicio
4. Validar flujo entre aplicaciones

**Fase 3 (Marzo 2026+):**
1. Agregar nuevos paÃ­ses (Colombia, Ecuador, etc.)
2. Mejorar frontend con tecnologÃ­a mÃ¡s moderna
3. Escalar FICEM Core con base datos productiva
4. Implementar autenticaciÃ³n/autorizaciÃ³n

### 6. CAMBIOS RESPECTO A PLAN ANTERIOR

| Aspecto | Plan Anterior | Plan Nuevo | RazÃ³n |
|---|---|---|---|
| Estructura | 1 app monolÃ­tica | 2 apps + microservicio | Mejor escalabilidad |
| Backend | Incluido en v1 | FICEM Core centralizado | ReutilizaciÃ³n cÃ³digo |
| Frontend | MenÃº confuso | 4C PerÃº dedicado | Experiencia paÃ­s-especÃ­fica |
| Generador Excel | En v1 | Microservicio API | Consumible por mÃºltiples frontends |
| Base de datos | Local SQLite | Centralizada en FICEM | Benchmarking unificado |
| GestiÃ³n empresas | En v1 | En FICEM Core | Control centralizado |

## Decisiones Tomadas

1. âœ… **Crear dos aplicaciones separadas** con responsabilidades claras
2. âœ… **Generador Excel como API** consumible por cualquier frontend
3. âœ… **FICEM Core = motor centralizado** para todos los paÃ­ses
4. âœ… **4C PerÃº = frontend especÃ­fico** con dashboard y reportes paÃ­s
5. âœ… **Documentar arquitectura** en nuevo archivo para claridad

## Trabajo realizado esta sesiÃ³n

1. âœ… RevisiÃ³n documentaciÃ³n existente
2. âœ… IdentificaciÃ³n de confusiones sobre app formularios
3. âœ… AnÃ¡lisis estado actual vs plan Etapa 1
4. âœ… DiseÃ±o nueva arquitectura de dos apps
5. âœ… DocumentaciÃ³n de cambio estratÃ©gico

## PrÃ³ximos pasos

1. Crear estructura carpetas `ficem-core/` y `4c-peru/`
2. Refactorizar cÃ³digo v1 para separar responsabilidades
3. Implementar mÃ³dulo de cÃ¡lculos A1-A3 en FICEM Core
4. Crear primeras pÃ¡ginas de 4C PerÃº
5. Documentar APIs REST para comunicaciÃ³n entre apps
6. Actualizar README del proyecto con nueva estructura

## Archivos a crear/modificar

- âœ… `docs/sesiones/sesion_2025-12-06.md` (ESTE ARCHIVO)
- ğŸ“ `docs/arquitectura/arquitectura_actualizada.md` (crear)
- ğŸ“ `docs/arquitectura/separacion_responsabilidades.md` (crear)
- ğŸ“ Actualizar `README.md` con nueva estructura

---

*Fin de sesiÃ³n 2025-12-06*
*Cambio estratÃ©gico documentado para claridad histÃ³rica del proyecto*
