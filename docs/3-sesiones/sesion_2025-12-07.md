# Sesión de Trabajo - 2025-12-07

## Fecha
2025-12-07

## Objetivo de la sesión
Definir arquitectura definitiva del sistema basada en funcionalidades por grupo de usuarios.

## Estado inicial
- Repos creados (4c-ficem-core, 4c-peru, latam-3c)
- Arquitectura anterior asumía ficem-core solo como backend
- Faltaba claridad sobre roles de usuarios y necesidades por grupo
- TDR de Perú revisado pero no analizado en detalle

## Trabajo realizado

### 1. Revisión del TDR FICEM-ASOCEM-PRODUCE

Documento: `docs/admin/TDR_FICEM_ASOCEM_Proyecto_MRV_Peru_3.pdf`

**3 componentes identificados:**
- Ítem 1: Protocolo PRODUCE (captura, cálculos, análisis)
- Ítem 2: Sistema MRV HR Perú (Dic 2025 + Jun 2026)
- Ítem 3: Calculadora 4C Perú (Abr 2026)

**Hallazgo clave:** PRODUCE requiere datos/protocolos propios de Perú (no solo los de FICEM).

### 2. Análisis de funcionalidades por grupo de usuarios

Creado documento: `docs/1-tecnica/02-funcionalidades-por-usuario.md`

**Grupos identificados:**
- FICEM (equipo regional): Carga, validación, cálculos, gestión
- País (ej: Perú): Dashboard, reportes, TDR local, stakeholders propios
- Empresas: Acceso a sus datos, descarga Excel, benchmarking
- IA/Analítica: Servicio transversal (knowledge-api)

**Roles dentro de cada grupo:**
- FICEM: Operador, Administrador, Analista
- País: Coordinador gremio, Funcionario gobierno, Analista, Observador
- Empresas: Editor, Supervisor, Observador

### 3. Decisión de arquitectura

**Discusión sobre opciones:**
1. Backend por app (distribuido) - Más complejo, más puntos de fallo
2. Backend centralizado - Menos código, más simple para un solo desarrollador

**Decisión final: Backend Centralizado + Frontends por App**

| Repo | Tipo | Tecnología | Estado |
|------|------|------------|--------|
| 4c-ficem-core | Backend + Frontend operador | FastAPI + PostgreSQL + Streamlit | Activo |
| 4c-peru | Frontend país | Next.js | Activo |
| knowledge-api | Servicio IA | FastAPI + Vector DB | En espera |
| latam-3c | Documentación | Markdown | Mantenimiento |

**Justificación:**
1. Un solo desarrollador → menos repos es mejor
2. knowledge-api separado porque no está contratado aún (puede venderse independiente)
3. Next.js para frontends país por mejor manejo de usuarios/sesiones vs Streamlit

## Decisiones tomadas

1. **Backend centralizado en ficem-core**
   - FastAPI para APIs REST
   - PostgreSQL con esquemas por país
   - Streamlit solo para operador FICEM
   - Usuarios/sesiones centralizados

2. **Frontends país en Next.js**
   - Mejor control de UI que Streamlit
   - Manejo granular de usuarios y sesiones
   - Solo consumen APIs de ficem-core

3. **knowledge-api separado**
   - No está contratado aún
   - Debe poder crecer/venderse independiente
   - Se integra cuando se contrate

4. **Datos de países en BD central**
   - Esquemas separados por país en PostgreSQL
   - No requiere BD local por país

## Próximos pasos identificados

1. Actualizar CLAUDE.md de los repos con nueva arquitectura
2. Reestructurar ficem-core para FastAPI + PostgreSQL
3. Iniciar 4c-peru con Next.js
4. Definir modelo de datos para esquemas por país

---

**Documentación actualizada:**
- `docs/1-tecnica/02-funcionalidades-por-usuario.md` (nuevo)

**Pendiente de commit:** Sí

---

*Fin de sesión 2025-12-07*
*Decisión: Arquitectura backend centralizado + frontends por país*
